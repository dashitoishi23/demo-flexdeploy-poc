--------------------------------------------------------
--  DDL for View VW_PROPERTY_DH
--------------------------------------------------------

  CREATE OR REPLACE FORCE EDITIONABLE VIEW "DW"."VW_PROPERTY_DH" ("ROW_WID", "ASSET_MANAGER", "ASSISTANT_REM", "BUILDING", "CAMPUS", "CITY", "CORPORATE_OFFICE", "COUNTRY_CODE", "COUNTRY", "DATA_CENTER_MANAGER", "DATA_CENTER_OPERATIONS_DIRECTOR", "DATASOURCE", "DISPOSITION_DATE", "DIVISION", "DOMESTIC_INTRL", "ELT", "ENTITY_PARENT", "ENTITY_TYPE", "EXTERNALLY_REPORTED", "FACILITY_DEVELOPMENT_STATUS", "FLOOR", "FORMALLY_KNOWN_AS_SITE_CODE", "GEOGRAPHIC_DIVISION", "GLOBAL_MARKET", "HRIS_DIVISION", "LANDLORD_OPERATED", "LATITUDE", "LEAF_LEVEL", "LEASED_OWNED", "LEGAL_ENTITY_NAME", "LINE_OF_BUSINESS", "LIVE_FLAG", "LOCKED_TIMESTAMP", "LOCKED", "LONGITUDE", "MANAGER_FACILITY_ENGINEERING", "MARKET", "MASTER_SITE_CODE", "METRO", "NON_DLR_SITE", "SITE_CODE_OPERATIONAL", "OWNERSHIP_PERCENT", "OWNERSHIP_TYPE", "PORTFOLIO_MANAGER", "PORTFOLIO_OPERATIONS_DIRECTOR", "PORTFOLIO_OWNERSHIP_PERCENTAGE", "ACQUIRED_DATE", "ADDRESS1", "ADDRESS2", "PROPERTY_ASSISTANT", "PROPERTY_CODE", "DIRECTOR", "LEGAL_ENTITY", "PROPERTY_MANAGER", "PROPERTY_NAME", "ZIP_POSTAL_CODE", "REGIONAL_MANAGER", "PROPERTY_TYPE", "REAL_ESTATE_MANAGER", "REGION", "REGIONAL_DATA_CENTER_OPERATIONS_MANAGER", "REGIONAL_PORTFOLIO_OPERATIONS_MANAGER", "SAME_STORE", "SAP_WAREHOUSE_CODE", "SENIOR_REAL_ESTATE_MANAGER", "SNAPSHOT_DATE", "SNAPSHOT_PERIOD", "SOURCE_CURRENCY_PROPERTY", "STABILIZATION_DATE", "STABILIZED_CURRENT_YEAR", "STABILIZED_NEXT_YEAR", "STATE", "SUITE_TYPE", "SUITE", "UNIT_DESC", "UNIT_STATUS", "UNIT_TYPE", "UNIT", "PROPERTY_SRC_KEY", "FLOOR_SRC_KEY", "SUITE_SRC_KEY", "BUILDING_SRC_KEY", "UNIT_TYPE_SRC_KEY", "UNIT_SRC_KEY", "LEGACY_SRC_KEY", "YARDI_OWNERSHIP_TYPE") DEFAULT COLLATION "USING_NLS_COMP"  AS 
  select
     W_PROPERTY_D.ROW_WID,
     nvl(W_PROPERTY_D.ASSET_MANAGER, '(Not Assigned)') ASSET_MANAGER,
     W_PROPERTY_D.ASSISTANT_REM,
     W_PROPERTY_D.BUILDING,
     CASE WHEN nvl(to_char(W_PROPERTY_D.CAMPUS),'(Not Assigned)') ='NA' THEN '(Not Assigned)' ELSE  nvl(to_char(W_PROPERTY_D.CAMPUS),'(Not Assigned)') END CAMPUS, --nvl(nullif( W_LOCATION_D.CAMPUS, '(Not Assigned)') , W_PROPERTY_D.CAMPUS) CAMPUS,
     nvl(nvl(nullif( W_LOCATION_D.CITY, '(Not Assigned)')  , W_PROPERTY_D.CITY),'(Not Assinged)') CITY,
     case  when W_LOCATION_D.CORPORATE_OFFICE in ('NA') or W_LOCATION_D.CORPORATE_OFFICE is null then '(Not Assigned)' else W_LOCATION_D.CORPORATE_OFFICE end CORPORATE_OFFICE,
     nvl(W_LOCATION_D.COUNTRY_CODE , W_PROPERTY_D.COUNTRY_CODE) COUNTRY_CODE ,
     nvl(nvl(W_LOCATION_D.COUNTRY , W_PROPERTY_D.COUNTRY),'(Not Assinged)') COUNTRY ,
     nvl( nullif( W_LOCATION_D.DATA_CENTER_MANAGER, '(Not Assigned)') , W_PROPERTY_D.DATA_CENTER_MANAGER)  DATA_CENTER_MANAGER,
     nvl(W_LOCATION_D.DATA_CENTER_OPERATIONS_DIRECTOR , '(Not Assigned)') DATA_CENTER_OPERATIONS_DIRECTOR,
     W_PROPERTY_D.DATASOURCE DATASOURCE,
     case  when  cast('01-JAN-1900' as DATE ) = W_PROPERTY_D.DISPOSITION_DATE then NULL else W_PROPERTY_D.DISPOSITION_DATE end  DISPOSITION_DATE ,
     case  when to_char(W_PROPERTY_D.DIVISION) in ('(Inactive)', 'NA', 'Not Assigned') then '(Not Assigned)' when to_char(W_PROPERTY_D.DIVISION) is null then '(Not Assigned)' else to_char(W_PROPERTY_D.DIVISION) end DIVISION ,
     W_PROPERTY_D.DOMESTIC_INTRL ,
     W_PROPERTY_D.ELT,
     CASE WHEN nvl(TO_CHAR(W_PROPERTY_D.ENTITY_PARENT) ,'(Not Assigned)')='NA' THEN '(Not Assigned)' ELSE nvl(TO_CHAR(W_PROPERTY_D.ENTITY_PARENT) ,'(Not Assigned)') END ENTITY_PARENT,
     CASE WHEN nvl(TO_CHAR(W_PROPERTY_D.ENTITY_TYPE),'(Not Assigned)')='NA' THEN '(Not Assigned)' ELSE nvl(TO_CHAR(W_PROPERTY_D.ENTITY_TYPE),'(Not Assigned)') END  ENTITY_TYPE ,
     case  when nvl(W_LOCATION_D.EXTERNALLY_REPORTED , W_PROPERTY_D.EXTERNALLY_REPORTED) in ('Y', '1') then 'Reported' when nvl(W_LOCATION_D.EXTERNALLY_REPORTED , W_PROPERTY_D.EXTERNALLY_REPORTED) in ('N', '0', 'NA', '(Not Assigned)') then 'Not Reported' when nvl(W_LOCATION_D.EXTERNALLY_REPORTED , W_PROPERTY_D.EXTERNALLY_REPORTED) is null then 'Not Reported' end EXTERNALLY_REPORTED,
     nvl(W_LOCATION_D.FACILITY_DEVELOPMENT_STATUS , '(Not Assigned)') FACILITY_DEVELOPMENT_STATUS,
     W_PROPERTY_D.FLOOR ,
     nvl(nvl( nullif( W_LOCATION_D.FORMALLY_KNOWN_AS_SITE_CODE, '(Not Assigned)') , W_PROPERTY_D.FORMALLY_KNOWN_AS_SITE_CODE),'(Not Assigned)') FORMALLY_KNOWN_AS_SITE_CODE,
     CASE WHEN nvl(TO_CHAR(W_PROPERTY_D.GEOGRAPHIC_DIVISION),'(Not Assigned)')='NA' THEN '(Not Assigned)' ELSE nvl(TO_CHAR(W_PROPERTY_D.GEOGRAPHIC_DIVISION),'(Not Assigned)') END GEOGRAPHIC_DIVISION,
     W_PROPERTY_D.GLOBAL_MARKET ,
     W_PROPERTY_D.HRIS_DIVISION ,
     nvl(W_LOCATION_D.LANDLORD_OPERATED,'(Not Assigned)') LANDLORD_OPERATED,
     W_PROPERTY_D.LATITUDE ,
     W_PROPERTY_D.LEAF_LEVEL ,
     W_PROPERTY_D.LEASED_OWNED, --nvl(nullif( W_LOCATION_D.LEASED_OWNED, '(Not Assigned)') , W_PROPERTY_D.LEASED_OWNED) LEASED_OWNED,
     nvl(W_PROPERTY_D.LEGAL_ENTITY_NAME,'(Not Assigned)') LEGAL_ENTITY_NAME,
     W_PROPERTY_D.LINE_OF_BUSINESS,
     W_PROPERTY_D.LIVE_FLAG ,
     W_PROPERTY_D.LOCKED_TIMESTAMP,
     case  when W_PROPERTY_D.LOCKED = 'Y' then '1' when W_PROPERTY_D.LOCKED = 'N' then '0' else W_PROPERTY_D.LOCKED end LOCKED,
     W_PROPERTY_D.LONGITUDE ,
     nvl(W_LOCATION_D.MANAGER_FACILITY_ENGINEERING , '(Not Assigned)') MANAGER_FACILITY_ENGINEERING,
     CASE WHEN nvl(TO_CHAR(W_PROPERTY_D.MARKET),'(Not Assigned)')='NA' THEN '(Not Assigned)' ELSE nvl(TO_CHAR(W_PROPERTY_D.MARKET),'(Not Assigned)') END MARKET,--nvl(nullif( W_LOCATION_D.MARKET, 'NA') , W_PROPERTY_D.MARKET) MARKET,
     CASE WHEN nvl(TO_CHAR(W_PROPERTY_D.MASTER_SITE_CODE),'(Not Assigned)')='NA' THEN '(Not Assigned)' ELSE nvl(TO_CHAR(W_PROPERTY_D.MASTER_SITE_CODE),'(Not Assigned)') END MASTER_SITE_CODE,
     nvl(W_LOCATION_D.METRO , '(Not Assigned)') METRO,
     case  when W_LOCATION_D.NON_DLR_SITE = '1' then 'True' when W_LOCATION_D.NON_DLR_SITE = '0' then 'False' else '(Not Assigned)' end  NON_DLR_SITE,
     nvl(nullif( W_LOCATION_D.SITE_CODE_OPERATIONAL, '(Not Assigned)') , W_PROPERTY_D.SITE_CODE) SITE_CODE_OPERATIONAL,
     W_PROPERTY_D.OWNERSHIP_PERCENT ,
     nvl(W_PROPERTY_D.OWNERSHIP_TYPE,'(Not Assigned)') OWNERSHIP_TYPE,  -- nvl(nullif( W_LOCATION_D.OWNERSHIP_TYPE, '(Not Assigned)')  , W_PROPERTY_D.OWNERSHIP_TYPE) OWNERSHIP_TYPE ,
     nvl(W_LOCATION_D.PORTFOLIO_MANAGER , '(Not Assigned)') PORTFOLIO_MANAGER,
     nvl(W_LOCATION_D.PORTFOLIO_OPERATIONS_DIRECTOR , '(Not Assigned)') PORTFOLIO_OPERATIONS_DIRECTOR,
     nvl(nvl(W_LOCATION_D.PORTFOLIO_OWNERSHIP_PERCENTAGE , W_PROPERTY_D.PORTFOLIO_OWNERSHIP_PERCENTAGE) , 1) PORTFOLIO_OWNERSHIP_PERCENTAGE,
     W_PROPERTY_D.ACQUIRED_DATE, --nvl(W_LOCATION_D.ACQUIRED_DATE , W_PROPERTY_D.ACQUIRED_DATE) ACQUIRED_DATE,
     nvl(W_LOCATION_D.ADDRESS1 , W_PROPERTY_D.ADDRESS1) ADDRESS1,
     nvl(W_LOCATION_D.ADDRESS2 , W_PROPERTY_D.ADDRESS2) ADDRESS2,
     nvl(nullif( W_LOCATION_D.PROPERTY_ASSISTANT, '(Not Assigned)') , W_PROPERTY_D.PROPERTY_ASSISTANT) PROPERTY_ASSISTANT,
     W_PROPERTY_D.PROPERTY_CODE ,
     W_PROPERTY_D.DIRECTOR ,
     CASE WHEN nvl(TO_CHAR(W_PROPERTY_D.LEGAL_ENTITY) ,'(Not Assigned)')='NA' THEN '(Not Assigned)' ELSE nvl(TO_CHAR(W_PROPERTY_D.LEGAL_ENTITY) ,'(Not Assigned)') END LEGAL_ENTITY,
     W_PROPERTY_D.PROPERTY_MANAGER ,
     case when W_PROPERTY_D.PROPERTY_NAME = '(Not Assigned)' then to_char( W_PROPERTY_D.ADDRESS1) else to_char(W_PROPERTY_D.PROPERTY_NAME) end PROPERTY_NAME,
     nvl(nvl(W_LOCATION_D.ZIP_POSTAL_CODE , W_PROPERTY_D.ZIP_POSTAL_CODE),'(Not Assigned)') ZIP_POSTAL_CODE ,
     nvl(W_PROPERTY_D.REGIONAL_MANAGER ,'(Not Assigned)') REGIONAL_MANAGER,
     W_PROPERTY_D.PROPERTY_TYPE, -- nvl( nullif( W_LOCATION_D.PROPERTY_TYPE, '(Not Assigned)') , W_PROPERTY_D.PROPERTY_TYPE) PROPERTY_TYPE,
     nvl(nullif( W_LOCATION_D.REAL_ESTATE_MANAGER, '(Not Assigned)') , W_PROPERTY_D.REAL_ESTATE_MANAGER) REAL_ESTATE_MANAGER,
     CASE WHEN nvl(TO_CHAR(W_PROPERTY_D.REGION),'(Not Assigned)') in ('NA','Not Assigned') THEN '(Not Assigned)' ELSE nvl(TO_CHAR(W_PROPERTY_D.REGION),'(Not Assigned)') END REGION, --nvl(nullif( W_LOCATION_D.REGION, 'NA') , W_PROPERTY_D.REGION) REGION,
     nvl(W_LOCATION_D.REGIONAL_DATA_CENTER_OPERATIONS_MANAGER , '(Not Assigned)') REGIONAL_DATA_CENTER_OPERATIONS_MANAGER ,
     nvl(W_LOCATION_D.REGIONAL_PORTFOLIO_OPERATIONS_MANAGER , '(Not Assigned)') REGIONAL_PORTFOLIO_OPERATIONS_MANAGER ,
     nvl(W_PROPERTY_D.SAME_STORE ,'(Not Assigned)') SAME_STORE,
     W_PROPERTY_D.SAP_WAREHOUSE_CODE ,
     nvl(W_LOCATION_D.SENIOR_REAL_ESTATE_MANAGER , '(Not Assigned)') SENIOR_REAL_ESTATE_MANAGER ,
     W_PROPERTY_D.SNAPSHOT_DATE ,
     W_PROPERTY_D.SNAPSHOT_PERIOD ,
     W_PROPERTY_D.SOURCE_CURRENCY_PROPERTY ,
     W_PROPERTY_D.STABILIZATION_DATE ,
     W_PROPERTY_D.STABILIZED_CURRENT_YEAR ,
     W_PROPERTY_D.STABILIZED_NEXT_YEAR ,
     nvl(nvl(W_LOCATION_D.STATE , W_PROPERTY_D.STATE),'(Not Assigned)') STATE,
     W_PROPERTY_D.SUITE_TYPE,
     W_PROPERTY_D.SUITE ,
     nvl(W_PROPERTY_D.UNIT_DESC ,'(Not Assigned)') UNIT_DESC,
     W_PROPERTY_D.UNIT_STATUS ,
     nvl(W_PROPERTY_D.UNIT_TYPE, '(Not Assigned)') UNIT_TYPE ,
     W_PROPERTY_D.UNIT,
     W_PROPERTY_D.PROPERTY_SRC_KEY,
     W_PROPERTY_D.FLOOR_SRC_KEY,
     W_PROPERTY_D.SUITE_SRC_KEY,
     W_PROPERTY_D.BUILDING_SRC_KEY,
     W_PROPERTY_D.UNIT_TYPE_SRC_KEY,
     W_PROPERTY_D.UNIT_SRC_KEY,
     W_PROPERTY_D.LEGACY_SRC_KEY,
     CASE WHEN nvl(TO_CHAR(W_PROPERTY_D.OWNERSHIP_TYPE),'(Not Assigned)')='NA' THEN '(Not Assigned)' ELSE nvl(TO_CHAR(W_PROPERTY_D.OWNERSHIP_TYPE),'(Not Assigned)') END YARDI_OWNERSHIP_TYPE
from 

          DW.VW_PROPERTY_D W_PROPERTY_D  
		  left outer join DW.VW_LOCATION_D W_LOCATION_D 
    		  On W_PROPERTY_D.MASTER_SITE_CODE = W_LOCATION_D.INTERNAL_LOCATION_CODE and W_PROPERTY_D.SNAPSHOT_PERIOD = W_LOCATION_D.SNAPSHOT_PERIOD
;
  GRANT READ ON "DW"."VW_PROPERTY_DH" TO "ODS";
  GRANT READ ON "DW"."VW_PROPERTY_DH" TO "DW_RO";
